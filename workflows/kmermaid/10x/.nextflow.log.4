Nov-03 15:08:39.138 [main] DEBUG nextflow.cli.Launcher - $> nextflow run /home/olga/code/nf-core/kmermaid--olgabot-khtools-extract-coding -latest -profile czbiohub_local,docker --bam /home/olga/data_sm/tabula-microcebus/rawdata/aligned_micmur3/10x/antoine__180917_A00111_0211_AHGKCVDMXX/ANTOINE_LUNG_P3/ANTOINE_LUNG_P3/outs/possorted_genome_bam.bam --custom_config_base /home/olga/code/nf-core/configs --molecules dna,protein,dayhoff --peptide_fasta /home/olga/data_lg/czbiohub-reference/ensembl/release-97/fasta/homo_sapiens/pep/Homo_sapiens.GRCh38.pep.all.fa.gz --ksizes 21 --log2_sketch_sizes 10,12,14,16 --bloomfilter_tablesize 1e8 --extract_coding_peptide_ksize 11 --extract_coding_peptide_molecule dayhoff --outdir /home/olga/data_sm/tabula-microcebus/kmermaid/dayhoff_ksize11/antoine__180917_A00111_0211_AHGKCVDMXX/ANTOINE_LUNG_P3/ANTOINE_LUNG_P3/ --extract_coding_jaccard_threshold 0.5 -work-dir /home/olga/pureScratch/nextflow-intermediates/ -resume
Nov-03 15:08:39.271 [main] INFO  nextflow.cli.CmdRun - N E X T F L O W  ~  version 19.04.1
Nov-03 15:08:40.228 [main] INFO  nextflow.cli.CmdRun - Launching `/home/olga/code/nf-core/kmermaid--olgabot-khtools-extract-coding/main.nf` [wise_curie] - revision: e83ba688e7
Nov-03 15:08:40.242 [main] DEBUG nextflow.config.ConfigBuilder - Found config base: /home/olga/code/nf-core/kmermaid--olgabot-khtools-extract-coding/nextflow.config
Nov-03 15:08:40.243 [main] DEBUG nextflow.config.ConfigBuilder - Parsing config file: /home/olga/code/nf-core/kmermaid--olgabot-khtools-extract-coding/nextflow.config
Nov-03 15:08:40.254 [main] DEBUG nextflow.config.ConfigBuilder - Applying config profile: `czbiohub_local,docker`
Nov-03 15:08:41.009 [main] DEBUG nextflow.config.ConfigBuilder - Available config profiles: [uppmax_devel, bigpurple, uppmax, test_bam, docker, gis, ccga, conda, singularity, munin, prince, czbiohub_aws, hebbe, cfc, uzh, debug, test, czbiohub_local, crick, czbiohub_aws_highpriority, phoenix, shh, mendel, uct_hex, awsbatch, binac]
Nov-03 15:08:41.075 [main] DEBUG nextflow.Session - Session uuid: ead34009-a863-4ad2-9297-d33730942da7
Nov-03 15:08:41.076 [main] DEBUG nextflow.Session - Run name: wise_curie
Nov-03 15:08:41.077 [main] DEBUG nextflow.Session - Executor pool size: 128
Nov-03 15:08:41.099 [main] DEBUG nextflow.cli.CmdRun - 
  Version: 19.04.1 build 5072
  Modified: 03-05-2019 12:29 UTC (05:29 PDT)
  System: Linux 4.4.0-165-generic
  Runtime: Groovy 2.5.6 on OpenJDK 64-Bit Server VM 1.8.0_222-8u222-b10-1ubuntu1~16.04.1-b10
  Encoding: UTF-8 (UTF-8)
  Process: 68842@ndnd [192.168.99.28]
  CPUs: 128 - Mem: 2 TB (44.1 GB) - Swap: 2 TB (2 TB)
Nov-03 15:08:41.162 [main] DEBUG nextflow.Session - Work-dir: /home/olga/pureScratch/nextflow-intermediates [nfs]
Nov-03 15:08:41.356 [main] DEBUG nextflow.Session - Session start invoked
Nov-03 15:08:41.366 [main] DEBUG nextflow.processor.TaskDispatcher - Dispatcher > start
Nov-03 15:08:41.367 [main] DEBUG nextflow.trace.TraceFileObserver - Flow starting -- trace file: /home/olga/data_sm/tabula-microcebus/kmermaid/dayhoff_ksize11/antoine__180917_A00111_0211_AHGKCVDMXX/ANTOINE_LUNG_P3/ANTOINE_LUNG_P3/pipeline_info/execution_trace.txt
Nov-03 15:08:41.383 [main] DEBUG nextflow.script.ScriptRunner - > Script parsing
Nov-03 15:08:41.899 [main] WARN  nextflow.Session - There's no process matching config selector: sourmash_compute_sketch_fastx -- Did you mean: sourmash_compute_sketch_bam?
Nov-03 15:08:41.901 [main] DEBUG nextflow.script.ScriptRunner - > Launching execution
Nov-03 15:08:42.080 [main] INFO  nextflow.Nextflow - [2m----------------------------------------------------[0m
                                        [0;32m,--.[0;30m/[0;32m,-.[0m
[0;34m        ___     __   __   __   ___     [0;32m/,-._.--~'[0m
[0;34m  |\ | |__  __ /  ` /  \ |__) |__         [0;33m}  {[0m
[0;34m  | \| |       \__, \__/ |  \ |___     [0;32m\`-._,-`-,[0m
                                        [0;32m`._,._,'[0m
[0;35m  nf-core/kmer-similarity v1.0dev[0m
[2m----------------------------------------------------[0m

Nov-03 15:08:42.085 [main] INFO  nextflow.Nextflow - Run Name          : wise_curie
BAM               : /home/olga/data_sm/tabula-microcebus/rawdata/aligned_micmur3/10x/antoine__180917_A00111_0211_AHGKCVDMXX/ANTOINE_LUNG_P3/ANTOINE_LUNG_P3/outs/possorted_genome_bam.bam
K-mer sizes       : 21
Molecule          : dna,protein,dayhoff
Log2 Sketch Sizes : 10,12,14,16
One Sig per Record: false
Bam chunk line count: 350
Count valid reads : 0
Saved Fastas      : fastas
Barcode umi read metadata: false
Max Resources     : 512 GB memory, 32 cpus, 10d time per job
Container         : docker - nfcore/kmermaid:dev
Output dir        : /home/olga/data_sm/tabula-microcebus/kmermaid/dayhoff_ksize11/antoine__180917_A00111_0211_AHGKCVDMXX/ANTOINE_LUNG_P3/ANTOINE_LUNG_P3/
Launch dir        : /home/olga/code/tabula-microcebus-extract-coding/workflows/kmermaid/10x
Working dir       : /home/olga/pureScratch/nextflow-intermediates
Script dir        : /home/olga/code/nf-core/kmermaid--olgabot-khtools-extract-coding
User              : root
Config Profile    : czbiohub_local,docker
Config Description: Chan Zuckerberg Biohub AWS Batch profile provided by nf-core/configs.
Config Contact    : Olga Botvinnik (@olgabot)
Config URL        : https://www.czbiohub.org/
Nov-03 15:08:42.085 [main] INFO  nextflow.Nextflow - [0m----------------------------------------------------[0m
Nov-03 15:08:42.161 [main] DEBUG nextflow.util.CacheHelper - Config settings `withName:multiqc|get_software_versions` matches process get_software_versions
Nov-03 15:08:42.164 [main] DEBUG nextflow.processor.ProcessFactory - << taskConfig executor: local
Nov-03 15:08:42.164 [main] DEBUG nextflow.processor.ProcessFactory - >> processorType: 'local'
Nov-03 15:08:42.171 [main] DEBUG nextflow.executor.Executor - Initializing executor: local
Nov-03 15:08:42.174 [main] INFO  nextflow.executor.Executor - [warm up] executor > local
Nov-03 15:08:42.179 [main] DEBUG n.processor.LocalPollingMonitor - Creating local task monitor for executor 'local' > cpus=32; memory=512 GB; capacity=128; pollInterval=100ms; dumpInterval=5m
Nov-03 15:08:42.184 [main] DEBUG nextflow.processor.TaskDispatcher - Starting monitor: LocalPollingMonitor
Nov-03 15:08:42.185 [main] DEBUG n.processor.TaskPollingMonitor - >>> barrier register (monitor: local)
Nov-03 15:08:42.188 [main] DEBUG nextflow.executor.Executor - Invoke register for executor: local
Nov-03 15:08:42.224 [main] DEBUG nextflow.Session - >>> barrier register (process: get_software_versions)
Nov-03 15:08:42.226 [main] DEBUG nextflow.processor.TaskProcessor - Creating operator > get_software_versions -- maxForks: 128
Nov-03 15:08:42.283 [main] DEBUG nextflow.util.CacheHelper - Config settings `withLabel:low_memory` matches label `low_memory` for process with name peptide_bloom_filter
Nov-03 15:08:42.284 [main] DEBUG nextflow.util.CacheHelper - Config settings `withName:peptide_bloom_filter|extract_coding` matches process peptide_bloom_filter
Nov-03 15:08:42.285 [main] DEBUG nextflow.processor.ProcessFactory - << taskConfig executor: local
Nov-03 15:08:42.285 [main] DEBUG nextflow.processor.ProcessFactory - >> processorType: 'local'
Nov-03 15:08:42.286 [main] DEBUG nextflow.executor.Executor - Initializing executor: local
Nov-03 15:08:42.288 [main] DEBUG nextflow.Session - >>> barrier register (process: peptide_bloom_filter)
Nov-03 15:08:42.288 [main] DEBUG nextflow.processor.TaskProcessor - Creating operator > peptide_bloom_filter -- maxForks: 128
Nov-03 15:08:42.321 [main] DEBUG nextflow.util.CacheHelper - Config settings `withLabel:high_memory` matches label `high_memory` for process with name sourmash_compute_sketch_bam
Nov-03 15:08:42.322 [main] DEBUG nextflow.util.CacheHelper - Config settings `withName:sourmash_compute_sketch_bam` matches process sourmash_compute_sketch_bam
Nov-03 15:08:42.323 [main] WARN  nextflow.util.CacheHelper - Unknown directive `one_signature_per_record` for process `sourmash_compute_sketch_bam`
Nov-03 15:08:42.323 [main] DEBUG nextflow.processor.ProcessFactory - << taskConfig executor: local
Nov-03 15:08:42.323 [main] DEBUG nextflow.processor.ProcessFactory - >> processorType: 'local'
Nov-03 15:08:42.324 [main] DEBUG nextflow.executor.Executor - Initializing executor: local
Nov-03 15:08:42.326 [main] DEBUG nextflow.Session - >>> barrier register (process: sourmash_compute_sketch_bam)
Nov-03 15:08:42.328 [main] DEBUG nextflow.processor.TaskProcessor - Creating operator > sourmash_compute_sketch_bam -- maxForks: 128
Nov-03 15:08:42.359 [main] DEBUG nextflow.util.CacheHelper - Config settings `withLabel:low_memory` matches label `low_memory` for process with name extract_coding
Nov-03 15:08:42.361 [main] DEBUG nextflow.util.CacheHelper - Config settings `withName:peptide_bloom_filter|extract_coding` matches process extract_coding
Nov-03 15:08:42.361 [main] DEBUG nextflow.processor.ProcessFactory - << taskConfig executor: local
Nov-03 15:08:42.362 [main] DEBUG nextflow.processor.ProcessFactory - >> processorType: 'local'
Nov-03 15:08:42.362 [main] DEBUG nextflow.executor.Executor - Initializing executor: local
Nov-03 15:08:42.365 [main] DEBUG nextflow.Session - >>> barrier register (process: extract_coding)
Nov-03 15:08:42.366 [main] DEBUG nextflow.processor.TaskProcessor - Creating operator > extract_coding -- maxForks: 128
Nov-03 15:08:42.383 [main] DEBUG nextflow.util.CacheHelper - Config settings `withLabel:mid_memory` matches label `mid_memory` for process with name sourmash_compute_sketch_fastx_nucleotide
Nov-03 15:08:42.384 [main] DEBUG nextflow.processor.ProcessFactory - << taskConfig executor: local
Nov-03 15:08:42.385 [main] DEBUG nextflow.processor.ProcessFactory - >> processorType: 'local'
Nov-03 15:08:42.387 [main] DEBUG nextflow.executor.Executor - Initializing executor: local
Nov-03 15:08:42.406 [main] DEBUG nextflow.Session - >>> barrier register (process: sourmash_compute_sketch_fastx_nucleotide)
Nov-03 15:08:42.408 [main] DEBUG nextflow.processor.TaskProcessor - Creating *combiner* operator for each param(s) at index(es): [0, 1]
Nov-03 15:08:42.411 [Actor Thread 7] ERROR nextflow.processor.TaskProcessor - Error executing process > 'sourmash_compute_sketch_bam (possorted_genome_bam_null)'

Caused by:
  Unknown variable 'molecule' -- Make sure it is not misspelt and defined somewhere in the script before using it

Source block:
  sketch_id = "molecule-${molecule}_ksize-${ksize}_log2sketchsize-${log2_sketch_size}"
  molecule = molecule
  not_dna = molecule != 'dna' ? '--no-dna' : ''
  ksize = ksize
  min_umi_per_barcode = params.min_umi_per_barcode ? "--count-valid-reads ${params.min_umi_per_barcode}" : ''
  line_count = params.line_count ? "--line-count ${params.line_count}" : ''
  metadata = params.write_barcode_meta_csv ? "--write-barcode-meta-csv ${params.write_barcode_meta_csv}": ''
  save_fastas = "--save-fastas ."
  processes = "--processes ${params.max_cpus}"
  def barcodes_file = params.barcodes_file ? "--barcodes-file ${barcodes_file.baseName}.tsv": ''
  def rename_10x_barcodes = params.rename_10x_barcodes ? "--rename-10x-barcodes ${rename_10x_barcodes.baseName}.tsv": ''
  """
    sourmash compute \\
      --ksize $ksize \\
      --$molecule \\
      $not_dna \\
      --num-hashes \$((2**$log2_sketch_size)) \\
      $processes \\
      $min_umi_per_barcode \\
      $line_count \\
      $rename_10x_barcodes \\
      $barcodes_file \\
      $save_fastas \\
      $metadata \\
      --output ${sample_id}_${sketch_id}.sig \\
      --input-is-10x $bam
    find . -type f -name "*.fasta" | while read src; do if [[ \$src == *"|"* ]]; then mv "\$src" \$(echo "\$src" | tr "|" "_"); fi done
  """

Tip: you can replicate the issue by changing to the process work dir and entering the command `bash .command.run`
Nov-03 15:08:42.416 [Actor Thread 7] DEBUG nextflow.Session - Session aborted -- Cause: Process `null` script contains error(s)
Nov-03 15:08:42.424 [main] DEBUG nextflow.processor.TaskProcessor - Creating operator > sourmash_compute_sketch_fastx_nucleotide -- maxForks: 128
Nov-03 15:08:42.435 [main] DEBUG nextflow.util.CacheHelper - Config settings `withLabel:mid_memory` matches label `mid_memory` for process with name sourmash_compute_sketch_fastx_peptide
Nov-03 15:08:42.436 [main] DEBUG nextflow.processor.ProcessFactory - << taskConfig executor: local
Nov-03 15:08:42.437 [main] DEBUG nextflow.processor.ProcessFactory - >> processorType: 'local'
Nov-03 15:08:42.437 [main] DEBUG nextflow.executor.Executor - Initializing executor: local
Nov-03 15:08:42.439 [main] DEBUG nextflow.Session - >>> barrier register (process: sourmash_compute_sketch_fastx_peptide)
Nov-03 15:08:42.440 [main] DEBUG nextflow.processor.TaskProcessor - Creating *combiner* operator for each param(s) at index(es): [0, 1, 2]
Nov-03 15:08:42.442 [main] DEBUG nextflow.processor.TaskProcessor - Creating operator > sourmash_compute_sketch_fastx_peptide -- maxForks: 128
Nov-03 15:08:42.458 [Actor Thread 7] DEBUG nextflow.Session - The following nodes are still active:
[process] sourmash_compute_sketch_bam
  status=ACTIVE
  port 0: (value) bound ; channel: single_ksize
  port 1: (value) bound ; channel: single_molecule
  port 2: (value) bound ; channel: single_log2_sketch_size
  port 3: (queue) closed; channel: barcodes_file
  port 4: (queue) OPEN  ; channel: -
  port 5: (queue) OPEN  ; channel: rename_10x_barcodes
  port 6: (cntrl) -     ; channel: $

[process] extract_coding
  status=ACTIVE
  port 0: (value) OPEN  ; channel: -
  port 1: (queue) OPEN  ; channel: -
  port 2: (cntrl) -     ; channel: $

Nov-03 15:08:42.464 [Task monitor] DEBUG n.processor.TaskPollingMonitor - <<< barrier arrives (monitor: local)
Nov-03 15:08:42.472 [main] DEBUG nextflow.util.CacheHelper - Config settings `withLabel:high_memory` matches label `high_memory` for process with name sourmash_compare_sketches
Nov-03 15:08:42.472 [main] DEBUG nextflow.util.CacheHelper - Config settings `withName:sourmash_compare_sketches` matches process sourmash_compare_sketches
Nov-03 15:08:42.473 [main] DEBUG nextflow.processor.ProcessFactory - << taskConfig executor: local
Nov-03 15:08:42.473 [main] DEBUG nextflow.processor.ProcessFactory - >> processorType: 'local'
Nov-03 15:08:42.473 [main] DEBUG nextflow.executor.Executor - Initializing executor: local
Nov-03 15:08:42.474 [main] DEBUG nextflow.Session - >>> barrier register (process: sourmash_compare_sketches)
Nov-03 15:08:42.474 [main] DEBUG nextflow.processor.TaskProcessor - Creating operator > sourmash_compare_sketches -- maxForks: 128
Nov-03 15:08:42.477 [main] DEBUG nextflow.script.ScriptRunner - > Await termination 
Nov-03 15:08:42.478 [main] DEBUG nextflow.Session - Session await
Nov-03 15:08:42.478 [main] DEBUG nextflow.Session - Session await > all process finished
Nov-03 15:08:42.478 [main] DEBUG nextflow.Session - Session await > all barriers passed
Nov-03 15:08:42.542 [Task submitter] DEBUG nextflow.executor.LocalTaskHandler - Launch cmd line: /bin/bash -ue .command.run
Nov-03 15:08:42.549 [Task submitter] INFO  nextflow.Session - [06/6c1579] Submitted process > get_software_versions
Nov-03 15:08:42.613 [main] INFO  nextflow.Nextflow - [0;35m[nf-core/kmermaid][0;31m Pipeline completed with errors[0m
Nov-03 15:08:42.624 [main] WARN  n.processor.TaskPollingMonitor - Killing pending tasks (1)
Nov-03 15:08:42.655 [main] DEBUG nextflow.trace.StatsObserver - Workflow completed > WorkflowStats[succeedCount=0; failedCount=1; ignoredCount=0; cachedCount=0; succeedDuration=0ms; failedDuration=0ms; cachedDuration=0ms]
Nov-03 15:08:42.655 [main] DEBUG nextflow.trace.TraceFileObserver - Flow completing -- flushing trace file
Nov-03 15:08:42.659 [main] DEBUG nextflow.trace.ReportObserver - Flow completing -- rendering html report
Nov-03 15:08:42.705 [main] DEBUG nextflow.trace.ReportObserver - Execution report summary data:
  {"get_software_versions":{"cpu":null,"mem":null,"vmem":null,"time":null,"reads":null,"writes":null,"cpuUsage":null,"memUsage":null,"timeUsage":null}}
Nov-03 15:08:43.468 [main] DEBUG nextflow.trace.TimelineObserver - Flow completing -- rendering html timeline
Nov-03 15:08:43.605 [main] DEBUG nextflow.CacheDB - Closing CacheDB done
Nov-03 15:08:43.616 [main] DEBUG nextflow.script.ScriptRunner - > Execution complete -- Goodbye
